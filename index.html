<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WhatsApp Cloud API Signup</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 20px; color: #333; }
    button {
      padding: 10px 20px;
      background-color: #25D366;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }
    .output { margin-top: 20px; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    .field { margin: 10px 0; }
    .uncopyable { user-select: none; font-weight: bold; }
    input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: #f4f4f4;
      font-family: monospace;
    }
  </style>
</head>
<body>

<h2>WhatsApp Cloud API Embedded Signup</h2>
<button onclick="startWhatsAppSignup()">Start WhatsApp Setup Wizard</button>

<div id="info" style="display:none;" class="output">
  <div class="field"><span class="uncopyable">Timestamp:</span> <span id="ts"></span></div>
  <div class="field"><span class="uncopyable">Name:</span> <span id="nm">Unknown</span></div>
  <div class="field"><span class="uncopyable">Status:</span> <span id="st">Connected</span></div>

  <div class="field"><label>Business Account ID: <input id="bid" readonly></label></div>
  <div class="field"><label>WABA ID: <input id="waba" readonly></label></div>
  <div class="field"><label>Phone ID: <input id="phone" readonly></label></div>
  <div class="field"><label>Access Token: <input id="token" readonly></label></div>
  <div class="field"><label>App ID: <input id="appid" value="6673587296096434" readonly></label></div>
</div>

<div id="doclink" style="display:none; margin-top:20px;">
  <p>If you don't have a WhatsApp Business Account (WABA), please follow this guide:</p>
  <a href="https://developers.facebook.com/docs/whatsapp/cloud-api/get-started" target="_blank">WhatsApp Cloud API Setup Guide</a>
</div>

<script src="https://connect.facebook.net/en_US/sdk.js"></script>
<script>
  const APP_ID = '6673587296096434';
  const CONFIG_ID = '168882059638822';

  window.fbAsyncInit = function() {
    FB.init({ appId: APP_ID, cookie: true, xfbml: false, version: 'v22.0' });
    console.log('FB SDK Initialized');
  };

  function startWhatsAppSignup() {
    console.log('Starting WhatsApp Embedded Signup Wizard...');
    FB.login(function(response) {
      console.log('FB.login Response:', response);

      if (response.status === 'connected' && response.authResponse) {
        const result = response.authResponse;

        console.log('Signup Result:', result);

        // Displaying returned WABA info directly
        document.getElementById('ts').textContent = new Date().toLocaleString();
        document.getElementById('nm').textContent = 'Unknown'; // Name not returned in this flow
        document.getElementById('st').textContent = 'Connected';

        document.getElementById('bid').value = result.business_id || 'Unavailable';
        document.getElementById('waba').value = result.waba_id || 'Unavailable';
        document.getElementById('phone').value = result.phone_number_id || 'Unavailable';
        document.getElementById('token').value = result.access_token || 'Unavailable';
        document.getElementById('appid').value = APP_ID;

        document.getElementById('info').style.display = 'block';
      } else {
        alert('Signup failed or was cancelled.');
        document.getElementById('doclink').style.display = 'block';
      }
    }, {
      config_id: CONFIG_ID,
      response_type: 'token_and_signed_request', // To receive access_token & signed_request
      override_default_response_type: true,
      scope: 'business_management,whatsapp_business_management,whatsapp_business_messaging,public_profile'
    });
  }
</script>

</body>
</html>
